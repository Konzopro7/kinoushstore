{% extends "core/base.html" %}







{% block title %}Finaliser la commande - Kinoush Store{% endblock %}
{% block meta_robots %}noindex, nofollow{% endblock %}















{% block content %}







<div class="container py-5">







  <div class="row g-4">















    <!-- COLONNE 1 : RÉCAP PANIER -->







    <div class="col-lg-6">







      <h1 class="h4 mb-3">Récapitulatif</h1>















      {% if items %}







        <div class="table-responsive">







          <table class="table align-middle">







            <thead>







              <tr>







                <th>Produit</th>







                <th class="text-center">Qté</th>







                <th class="text-end">Prix</th>







                <th class="text-end">Total</th>







              </tr>







            </thead>







            <tbody>







              {% for item in items %}







                <tr>







                  <td>{{ item.title }}</td>







                  <td class="text-center">{{ item.quantity }}</td>







                  <td class="text-end">{{ item.price }} $</td>







                  <td class="text-end">{{ item.line_total }} $</td>







                </tr>







              {% endfor %}







            </tbody>







          </table>







        </div>















        <div class="border-top pt-3">
          <div class="d-flex justify-content-between">
            <span>Sous-total</span>
            <span id="checkout-subtotal" data-subtotal="{{ total|floatformat:2 }}">{{ total|floatformat:2 }} $</span>
          </div>
          <div class="d-flex justify-content-between">
            <span>Frais de livraison</span>
            <span id="checkout-shipping">{{ shipping_default|floatformat:2 }} $</span>
          </div>
          <div class="d-flex justify-content-between fw-bold mt-2">
            <span>Total</span>
            <span id="checkout-total">{{ grand_total_default|floatformat:2 }} $</span>
          </div>
        </div>







      {% else %}







        <p>Votre panier est vide.</p>







      {% endif %}







    </div>















    <!-- COLONNE 2 : INFOS CLIENT -->







    <div class="col-lg-6">







      <h2 class="h5 mb-3">Informations de livraison</h2>















      {% if items %}







        <form method="post" action="{% url 'shop:start_payment' %}">























  {% csrf_token %}















  <h2 class="h5 mb-3">Informations de livraison</h2>















  <div class="row g-3">







    <div class="col-md-6">







      <label class="form-label">Prénom</label>







      <input class="form-control" name="first_name" autocomplete="given-name" required>







    </div>















    <div class="col-md-6">







      <label class="form-label">Nom</label>







      <input class="form-control" name="last_name" autocomplete="family-name" required>







    </div>















    <div class="col-12">







      <label class="form-label">Email</label>







      <input class="form-control" type="email" name="email" autocomplete="email"







             placeholder="ex: client@gmail.com" required>







      <div class="form-text">On enverra la confirmation de commande à cette adresse.</div>







    </div>















    <div class="col-12">







      <label class="form-label">Adresse</label>







      <input class="form-control" name="address" autocomplete="street-address"







             placeholder="Rue, numéro, appartement..." required>







    </div>















    <div class="col-md-6">







      <label class="form-label">Ville</label>







      <input class="form-control" name="city" autocomplete="address-level2" required>







    </div>















    <div class="col-md-6">







      <label class="form-label">Téléphone (optionnel)</label>







      <input class="form-control" name="phone" autocomplete="tel" placeholder="+1 ...">







    </div>







  </div>















  <hr class="my-4">
  <h5 class="mb-2">Livraison</h5>
  <p class="text-muted mb-3">Frais de livraison fixes : 10 $.</p>
  <div class="mb-3">
    <div class="form-check">
      <input class="form-check-input shipping-option" type="radio" name="shipping_fee" id="ship_standard" value="10.00" checked>
      <label class="form-check-label" for="ship_standard">Livraison standard (+10 $)</label>
    </div>
  </div>
  <hr class="my-4">















  <h5 class="mb-2">Paiement</h5>







  <p class="text-muted mb-3">Paiement sécurisé par carte (Visa / Mastercard) via Stripe.</p>















  <div class="mb-3">







    <div class="form-check">







      <input class="form-check-input" type="radio" name="payment_method" id="pay_card" value="card" checked>







      <label class="form-check-label" for="pay_card">Carte (Visa / Mastercard)</label>







    </div>







  </div>















 <button id="submit" type="submit" class="btn btn-dark w-100 mt-3">







  Payer maintenant







</button>















  <a href="{% url 'shop:cart_detail' %}" class="btn btn-outline-secondary w-100 mt-2">







    Retour au panier







  </a>







</form>















      {% endif %}







    </div>















  </div>







</div>








<script>
  document.addEventListener("DOMContentLoaded", function () {
    const subtotalEl = document.getElementById("checkout-subtotal");
    const shippingEl = document.getElementById("checkout-shipping");
    const totalEl = document.getElementById("checkout-total");
    const options = document.querySelectorAll("input[name=\"shipping_fee\"]");
    if (!subtotalEl || !shippingEl || !totalEl || options.length === 0) {
      return;
    }
    const base = parseFloat(subtotalEl.dataset.subtotal || "0") || 0;
    const format = (val) => val.toFixed(2) + " $";
    const update = () => {
      const selected = document.querySelector("input[name=\"shipping_fee\"]:checked");
      const fee = selected ? parseFloat(selected.value) || 0 : 0;
      shippingEl.textContent = format(fee);
      totalEl.textContent = format(base + fee);
    };
    options.forEach((opt) => opt.addEventListener("change", update));
    update();
  });
</script>

{% endblock %}













